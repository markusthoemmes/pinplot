<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Hackathon Stuttgart - Storymapper</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<!-- Le styles -->
		<link href="css/style.css" media="screen" rel="stylesheet" type="text/css">
		<link href="css/reset.css" media="screen" rel="stylesheet" type="text/css">
		<link href="css/application.css" media="screen" rel="stylesheet" type="text/css">
		<link href="css/jQRangeSlider/classic.css" media="screen" rel="stylesheet" type="text/css">
		<link href="img/favicon.ico" rel="shortcut icon" type="image/vnd.microsoft.icon">
		<!-- Scripts -->
		<!--[if lt IE 9]><script type="text/javascript" src="/storymapper/frontend/js/html5shiv.js"></script><![endif]-->
		<!--[if lt IE 9]><script type="text/javascript" src="/storymapper/frontend/js/respond.min.js"></script><![endif]-->
		<script type="text/javascript" src="js/jquery.min.js"></script>
		<script type="text/javascript" src="js/jquery-ui.min.js"></script>
		<script type="text/javascript" src="js/jQRangeSlider/jQAllRangeSliders-min.js"></script>
		<script type="text/javascript" src="js/data.js"></script>
		<script type="text/javascript" src="js/map.js"></script>
		<script type="text/javascript" src="http://twitter.github.io/typeahead.js/releases/latest/typeahead.bundle.js"></script>
	</head>
	<body>
		<div id="fullscreen-container">
			<div id="wrapper" style="margin: 0px; padding: 0px; width: 100%; height: 100px;">
				<script type="text/javascript"
						src="http://maps.googleapis.com/maps/api/js">
				</script>
				<script type="text/javascript">

					//
					$(document).ready(function () {

						appData.getBook('54540dcce3118013501512b0', function(data) {

							var mapOptions = {
								center: new google.maps.LatLng(data.events[0].location.lat, data.events[0].location.lon),
								zoom: 8,
								mapTypeId: google.maps.MapTypeId.ROADMAP
							};
							appMap.map = new google.maps.Map(document.getElementById("map"),
								mapOptions);

							var createObjectsInBounds = function(map, lowerBound, upperBound) {
								var coordinates = [];
								for(var i = 0; i < data.events.length; i++) {
									var currentEvent = data.events[i];
									if(currentEvent.characterCount >= lowerBound && currentEvent.characterCount <= upperBound) {

										appMap.addObject(new google.maps.Marker({
											position: new google.maps.LatLng(currentEvent.location.lat, currentEvent.location.lon)
										}));

										coordinates.push(new google.maps.LatLng(currentEvent.location.lat, currentEvent.location.lon));
									}
								}

								appMap.addObject(new google.maps.Polyline({
									path: coordinates,
									strokeColor: "#FF0000",
									strokeOpacity: 1.0,
									strokeWeight: 2
								}));
							};
							createObjectsInBounds(map, data.events[0].characterCount, data.events[data.events.length-1].characterCount);


							$("#pageline").rangeSlider({
								step: 1, 
								bounds: {min: data.events[0].characterCount, max: data.events[data.events.length-1].characterCount},
								defaultValues: {min: data.events[0].characterCount, max: data.events[data.events.length-1].characterCount}
							});
							$('#pageline').bind('valuesChanging', function(e, data) {
								appMap.clearMap();
								createObjectsInBounds(map, data.values.min, data.values.max);
							});
						});


						// Initialize jQuery slider
						$("#timeline").dateRangeSlider();

						// @TODO: use data 
						$("#timeline").dateRangeSlider("option", "bounds", {
							min: new Date(2012, 0, 1),
							max: new Date(2012, 11, 31)
						});
					});

				</script>

				<div id="navigation">

				</div>
				<div id="map"></div>
				<div id="search"><input id="search-input" type="text" value="search"/></div>
				<div id="lines">
					<div id="pageline" style="border: red solid 1px;"></div>
					<div id="timeline" style="border: blue solid 1px;"></div>
				</div>            </div>
		</div>
	</body>
</html>
